# Plan 03-01: Add Form Validation with Zod + React Hook Form

## Overview

Add client-side form validation to both contact forms (V1 and V2) using react-hook-form + Zod schema validation. This provides immediate feedback to users with bilingual error messages.

## Why This Matters

Contact forms currently accept any input with no validation. Users can submit invalid emails, empty fields, or incorrect data formats. Validation ensures quality quote requests and better user experience.

## Research Summary

**Libraries selected:**
- `react-hook-form` 7.55.0 (already installed) - Form state management
- `zod` - Schema validation with TypeScript type inference
- `@hookform/resolvers` - Bridge between react-hook-form and Zod

**Best practices from research:**
- Use `zodResolver` to connect Zod schemas with react-hook-form
- Validate `onBlur` mode for better UX (less intrusive than `onChange`)
- Infer TypeScript types from Zod schema using `z.infer<typeof schema>`
- Provide clear, bilingual error messages for all validation rules

## Tasks

- [x] **Task 1**: Install validation dependencies
  - ✓ Installed `zod` 4.3.5 for schema validation
  - ✓ Installed `@hookform/resolvers` 5.2.2 for react-hook-form integration
  - ✓ Verified in package.json
  - Files: `package.json`, `pnpm-lock.yaml`

- [x] **Task 2**: Create Zod validation schema
  - ✓ Created schema with validation rules for both V1 and V2 forms
  - ✓ Added bilingual error messages (translation keys)
  - ✓ Exported TypeScript types using `z.infer`
  - Files: `src/lib/validations/contactSchema.ts` (created)

- [x] **Task 3**: Update Contact.tsx with validation
  - ✓ Imported and configured useForm with zodResolver
  - ✓ Registered all form fields (name, email, projectType, message)
  - ✓ Added error display below each input field
  - ✓ Set validation mode to `onBlur`
  - ✓ Added aria-invalid attributes for accessibility
  - Files: `src/app/components/Contact.tsx`

- [x] **Task 4**: Update ContactV2.tsx with validation
  - ✓ Applied same validation pattern using contactSchemaV2
  - ✓ Consistent error display styling
  - ✓ All fields validated (name, email, message)
  - Files: `src/app/components/v2/ContactV2.tsx`

- [x] **Task 5**: Add error message translations
  - ✓ Added validation.* keys to English translation
  - ✓ Added validation.* keys to Korean translation
  - ✓ Error messages use translation keys
  - Files: `src/locales/en/translation.json`, `src/locales/ko/translation.json`

- [x] **Task 6**: Style validation error messages
  - ✓ Error text styled with text-red-600 and text-sm
  - ✓ Accessible with aria-invalid and role="alert"
  - ✓ Error messages display below fields with mt-1 spacing
  - Files: `src/app/components/Contact.tsx`, `src/app/components/v2/ContactV2.tsx`

- [x] **Task 7**: Test validation behavior
  - ✓ Build passed successfully (no TypeScript errors)
  - ✓ Form prevents submission with validation schema
  - ✓ Error messages use translation keys (bilingual ready)
  - ✓ Validation configured for onBlur mode
  - Files: None (verification complete)

## Acceptance Criteria

- [x] Zod and @hookform/resolvers are installed
- [x] Validation schema is defined with all rules
- [x] Both Contact forms use react-hook-form with zodResolver
- [x] Error messages display below fields when validation fails
- [x] Error messages are bilingual (English + Korean)
- [x] Validation triggers onBlur (not onChange)
- [x] TypeScript types are inferred from Zod schema
- [x] Forms prevent submission when validation fails
- [x] Build passes with no TypeScript errors

## Dependencies

- Phase 2 complete (localization infrastructure)
- react-hook-form 7.55.0 (already installed)

## Technical Notes

**Validation Schema Example:**
```typescript
import { z } from 'zod';

export const contactSchema = z.object({
  name: z.string()
    .min(2, { message: 'validation.name.min' })
    .max(50, { message: 'validation.name.max' }),

  email: z.string()
    .email({ message: 'validation.email.invalid' }),

  projectType: z.string()
    .min(1, { message: 'validation.projectType.required' }),

  message: z.string()
    .min(10, { message: 'validation.message.min' })
    .max(1000, { message: 'validation.message.max' })
});

export type ContactFormData = z.infer<typeof contactSchema>;
```

**React Hook Form Integration:**
```typescript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { contactSchema, ContactFormData } from '@/lib/validations/contactSchema';

const { register, handleSubmit, formState: { errors } } = useForm<ContactFormData>({
  resolver: zodResolver(contactSchema),
  mode: 'onBlur'
});
```

**Error Display Pattern:**
```typescript
<Input {...register('email')} />
{errors.email && (
  <p className="text-sm text-red-600 mt-1">
    {t(errors.email.message)}
  </p>
)}
```

## Important Notes

**This plan does NOT include:**
- Form submission logic (handled in Plan 03-02)
- Email service integration (handled in Plan 03-02)
- Success/loading states (handled in Plan 03-02)

**This plan focuses solely on:**
- Client-side validation
- Error message display
- Type-safe form data

## Estimated Scope

Medium - Form validation setup requires careful integration with existing components and bilingual error messages.
